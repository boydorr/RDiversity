---
title: "Introduction to rdiversity"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to rdiversity}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(collapse = T, comment = "#>")
options(tibble.print_min = 4L, tibble.print_max = 4L)
base::library(ggplot2)
base::library(rdiversity)
set.seed(1014)
```


## Na&iuml;ve
In the na&iuml;ve-type case, we consider all species to be completely distinct. 
```{r}
# Populate partition matrix
partition <- matrix(sample(8), ncol = 2)
rownames(partition) <- paste0("sp", 1:4)
colnames(partition) <- LETTERS[1:2]
partition <- partition / sum(partition)

# Generate metacommunity object
meta <- metacommunity(partition)
```
Note that the metacommunity object now contains an identity matrix in the `@similarity` slot (since all species are completely distinct):
```{r}
meta@similarity
```
Diversity can then be calculated in the usual way:
```{r}
norm_sub_alpha(meta, 0:2)
```


## Taxonomic
To calculate taxonomic diversity
```{r}
# Generate lookup table
Species <- c("tenuifolium", "asterolepis", "simplex var.grandiflora", "simplex var.ochnacea")
Genus <- c("Protium", "Quararibea", "Swartzia", "Swartzia")
Family <- c("Burseraceae", "Bombacaceae", "Fabaceae", "Fabaceae")
Subclass <- c("Sapindales", "Malvales", "Fabales", "Fabales")
lookup <- cbind.data.frame(Species, Genus, Family, Subclass)

# Assign values for each level (Shimatani's taxonomic distance)
tax_distance <- c(Species = 0, Genus = 1, Family = 2, Subclass = 3, Other = 4)

# Populate partition matrix
partition <- matrix(sample(8), ncol = 2)
rownames(partition) <- Species
colnames(partition) <- LETTERS[1:2]
partition <- partition / sum(partition)

# Generate pairwise distances and similarities
distance <- tax2dist(lookup, tax_distance, FALSE)
similarity <- dist2sim(distance, "linear")

# Generate metacommunity object
meta <- metacommunity(partition, similarity)
```


## Distance-based phylogenetic
```{r}
partition <- matrix(sample(10), nrow = 5)
rownames(partition) <- paste0("sp", 1:5)
partition <- partition / sum(partition)

tree <- ape::rtree(5)
tree$tip.label <- paste0("sp", 1:5)
distance <- phy2dist(tree)
similarity <- dist2sim(distance, "linear")

meta <- metacommunity(partition, similarity)
```


## Tree-based phylogenetic
```{r}
partition <- matrix(sample(10), nrow = 5)
rownames(partition) <- paste0("sp", 1:5)
partition <- partition / sum(partition)

tree <- ape::rtree(5)
tree$tip.label <- paste0("sp", 1:5)
similarity <- phy2branch(tree, partition)

meta <- metacommunity(partition, similarity)
```


## User defined distance
```{r}
partition <- matrix(sample(6), nrow = 3)
rownames(partition) <- paste0("sp", 1:3)
partition <- partition / sum(partition)

distance <- matrix(c(0,.75,1,.75,0,.3,1,.3,0), nrow = 3)
rownames(distance) <- paste0("sp", 1:3)
colnames(distance) <- paste0("sp", 1:3)
distance <- distance(distance, "my_taxonomy")
similarity <- dist2sim(distance, "linear")

meta <- metacommunity(partition, similarity)
```


## User defined similarity
```{r}
partition <- matrix(sample(6), nrow = 3)
rownames(partition) <- paste0("sp", 1:3)
partition <- partition / sum(partition)

similarity <- matrix(c(1, 0.8, 0, 0.8, 1, 0.1, 0, 0.1, 1), nrow = 3)
rownames(similarity) <- paste0("sp", 1:3)
colnames(similarity) <- paste0("sp", 1:3)
similarity <- similarity(similarity, "my_functional")

meta <- metacommunity(partition, similarity)
```




